---
title: "WHO Data"
author: "Kyle DeQuesnay, Jeffrey Feng,Brandon Kerbow, Derek Orji"
resource_files:
- .Renviron
output:
  html_notebook:
    code_folding: hide
    toc: yes
    toc_depth: 4
    toc_float: yes
runtime: shiny
---
  

  
  
  
```{r setup, echo=FALSE, message=FALSE}
library(tidyverse)
library(shiny)
library(grid)
library(data.world)
library(DT)
library(shinydashboard)
library(plotly)
library(lubridate)
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
project <- "https://data.world/jeffrey-feng/s18-edv-project-3/" 
data.world::set_config(cfg_env("DW_API")) 
regions <- data.world::query(data.world::qry_sql(
  "   
  select distinct WHO_Cleanest.region from WHO_Cleanest
  "), 
  dataset = project)
```

```{r}
project <- "https://data.world/jeffrey-feng/s18-edv-project-3/" 
data.world::set_config(cfg_env("DW_API")) 
incomes <- data.world::query(data.world::qry_sql(
  "   
  select distinct WHO_Cleanest.gross_national_income_per_capita_ppp_international
  from WHO_Cleanest
  "), 
  dataset = project)
```

```{r}
project <- "https://data.world/jeffrey-feng/s18-edv-project-3/"  
data.world::set_config(cfg_env("DW_API")) 
system <- data.world::query(data.world::qry_sql(
  "   
  select distinct WHO_Cleanest.system_of_government from WHO_Cleanest
  "), 
  dataset = project)
```



```{r}

df1 <- eventReactive(c(input$selectIncome_1, input$selectRegion_1), { 
  project <- "https://data.world/jeffrey-feng/s18-edv-project-3/" 
  data.world::set_config(cfg_env("DW_API")) 
  paramQuery <- data.world::qry_sql(
    "   
    select region, gross_national_income_per_capita_ppp_international, system_of_government
    from WHO_Cleanest h
    where gross_national_income_per_capita_ppp_international between ? and ? and region in (?,?,?,?,?,?,?,?,?,?) and system_of_government in ('Republic','Constitutional_monarchy', 'Absolute_monarchy')
    
    order by region
    ")
  paramQuery$params <- c(input$selectIncome_1[1], input$selectIncome_1[2], input$selectRegion_1[1], input$selectRegion_1[2], input$selectRegion_1[3], input$selectRegion_1[4], input$selectRegion_1[5], input$selectRegion_1[6], input$selectRegion_1[7], input$selectRegion_1[8], input$selectRegion_1[9], input$selectRegion_1[10])
  data.world::query(paramQuery, dataset = project)
}) 
```








```{r}
Region <- eventReactive(c(input$selectRegion_1), { 
  library('stringr')
  str_c(input$selectRegion_1, collapse=', ')
})
```

howdy hey
```{r}
Income <- eventReactive(c(input$selectIncome_1), { 
  library('stringr')
  str_c(input$selectIncome_1, collapse=', ')
})
```


```


#Boxplot 1

```{r}
inputPanel(
  selectInput
  ("selectRegions_1", label = "Select Regions",choices = regions, multiple=TRUE, selected=c("SUB-SAHARAN AFRICA", "BALTICS", "OCEANIA", "C.W.OF IND.STATES", "WESTERN EUROPE", "LATIN AMER. & CARIB", "ASIA (EX. NEAR EAST)", "EASTERN EUROPE", "NEAR EAST", "NORTHERN AFRICA")
    
  )
  
  ,sliderInput("selectIncome_1", label = "Gross national income per capita:", min = 0, max = 61000, value = c(0, 61000), step = 100)
)
```

```{r}
dashboardPage(
  dashboardHeader(
  ),
  dashboardSidebar(
    sidebarMenu(
      menuItem("proportion of population under 15", tabName = "boxplot1", icon = icon("dashboard1"))
    )
  ),
  dashboardBody(
    tabItems(
      # 1. "Gross national income per capita by region" tab content
      tabItem(tabName = "boxplot1",
              source("BoxPlot1UI.R",local = TRUE)$value
      )
    )
  )
)

source("BoxPlot1Server.R", local = TRUE)

```


